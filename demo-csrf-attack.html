<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSRF Attack Demo - T·∫•n c√¥ng gi·∫£ m·∫°o y√™u c·∫ßu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 4px;
        }
        
        .warning h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .warning p {
            color: #856404;
            font-size: 14px;
            line-height: 1.6;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .demo-section h2 {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .description {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-attack {
            background: #dc3545;
            color: white;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-attack:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }
        
        .btn-reset {
            background: #6c757d;
            color: white;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-reset:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
            display: block;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #f5c6cb;
            display: block;
        }
        
        .form-demo {
            background: white;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .form-demo label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: bold;
        }
        
        .form-demo input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .info-box strong {
            color: #0c5aa0;
        }
        
        .info-box p {
            color: #0c5aa0;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .attack-name {
            display: inline-block;
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="warning">
            <h3>‚ö†Ô∏è C·∫£nh b√°o - Ch·ªâ d√πng cho m·ª•c ƒë√≠ch h·ªçc t·∫≠p</h3>
            <p>
                ƒê√¢y l√† demo gi√°o d·ª•c ƒë·ªÉ hi·ªÉu v·ªÅ <strong>CSRF (Cross-Site Request Forgery)</strong> attacks.
                <strong>KH√îNG</strong> s·ª≠ d·ª•ng ƒë·ªÉ t·∫•n c√¥ng c√°c h·ªá th·ªëng th·ª±c t·∫ø.
            </p>
        </div>

        <h1>üîê CSRF Attack Demo</h1>

        <!-- Demo 1: Form CSRF kh√¥ng c√≥ token -->
        <div class="demo-section">
            <h2>üìå Demo 1: Form CSRF (Kh√¥ng c√≥ CSRF Token)</h2>
            <p class="description">
                <span class="attack-name">T·∫§N C√îNG CSRF</span>
                Attacker t·∫°o form gi·∫£ m·∫°o v√† g·ª≠i request ƒë·∫øn server m√† <strong>kh√¥ng c√≥ CSRF token</strong>.
                Server s·∫Ω reject v√¨ CSRF token kh√¥ng h·ª£p l·ªá.
            </p>
            
            <div class="info-box">
                <strong>üéØ M·ª•c ƒë√≠ch:</strong>
                <p>
                    Gi·∫£ m·∫°o y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ ƒëƒÉng nh·∫≠p ho·∫∑c thay ƒë·ªïi th√¥ng tin.
                </p>
            </div>
            
            <div class="form-demo">
                <label>M√¥ ph·ªèng: Form Login CSRF (Thi·∫øu CSRF Token)</label>
                <input type="text" value="Username: admin" readonly>
                <input type="text" value="Password: hacked123" readonly>
                <input type="text" value="_csrf: (MISSING)" readonly style="color: red;">
            </div>
            
            <div class="button-group">
                <button class="btn-attack" onclick="submitCSRFForm()">
                    üöÄ G·ª≠i CSRF Attack
                </button>
                <button class="btn-reset" onclick="resetDemo()">
                    üîÑ Reset
                </button>
            </div>
            
            <div id="result1" class="result"></div>
        </div>

        <!-- Demo 2: Auto-submit Form -->
        <div class="demo-section">
            <h2>üìå Demo 2: Auto-Submit CSRF Form</h2>
            <p class="description">
                Attacker c√≥ th·ªÉ auto-submit form khi ng∆∞·ªùi d√πng truy c·∫≠p trang gi·∫£ m·∫°o.
                Ng∆∞·ªùi d√πng kh√¥ng c·∫ßn click button - form t·ª± ƒë·ªông g·ª≠i.
            </p>
            
            <div class="info-box">
                <strong>üéØ K·ªãch b·∫£n:</strong>
                <p>
                    Ng∆∞·ªùi d√πng click v√†o link l·∫° ‚Üí Trang gi·∫£ m·∫°o t·ª± ƒë·ªông g·ª≠i request ‚Üí Server reject (CSRF token thi·∫øu)
                </p>
            </div>
            
            <div class="button-group">
                <button class="btn-attack" onclick="autoSubmitCSRFForm()">
                    üöÄ Auto-Submit CSRF Form
                </button>
                <button class="btn-reset" onclick="resetDemo()">
                    üîÑ Reset
                </button>
            </div>
            
            <div id="result2" class="result"></div>
        </div>

        <!-- Demo 3: Th√¥ng tin CSRF Protection -->
        <div class="demo-section">
            <h2>üìå C∆° ch·∫ø ph√≤ng ch·ªëng CSRF</h2>
            <p class="description">
                Server t·∫°o <strong>CSRF token</strong> duy nh·∫•t cho m·ªói session.
                Request h·ª£p l·ªá ph·∫£i c√≥ token n√†y, n·∫øu thi·∫øu ho·∫∑c sai ‚Üí Request b·ªã reject.
            </p>
            
            <div class="code-block">
// Middleware csrf.js - Generate token
if (!req.session.csrfToken) {
  req.session.csrfToken = crypto.randomBytes(32).toString('hex');
}

// Verify token on POST request
if (!token || token !== req.session.csrfToken) {
  return res.status(403).render('error', {
    message: 'CSRF token kh√¥ng h·ª£p l·ªá'
  });
}
            </div>
        </div>
    </div>

    <!-- Hidden CSRF Form (kh√¥ng c√≥ token) -->
    <form id="csrfForm" method="POST" action="http://localhost:3000/login" style="display:none;">
        <input type="hidden" name="username" value="admin">
        <input type="hidden" name="password" value="hacked123">
        <!-- ‚ùå Thi·∫øu CSRF token -->
    </form>

    <script>
        /**
         * G·ª≠i CSRF attack b·∫±ng c√°ch submit form
         */
        async function submitCSRFForm() {
            const resultDiv = document.getElementById('result1');
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ ƒêang g·ª≠i request...';
            
            try {
                // T·∫°o FormData t·ª´ form
                const formData = new FormData(document.getElementById('csrfForm'));
                
                const response = await fetch('http://localhost:3000/login', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include' // G·ª≠i cookies
                });
                
                if (response.status === 403) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ CSRF Attack Blocked!</strong><br>
                        Status: ${response.status} Forbidden<br>
                        Message: CSRF token kh√¥ng h·ª£p l·ªá<br>
                        <br>
                        <strong>Gi·∫£i th√≠ch:</strong> Request b·ªã reject v√¨ thi·∫øu CSRF token h·ª£p l·ªá.
                    `;
                } else if (response.status === 429) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ Rate Limited!</strong><br>
                        Status: ${response.status}<br>
                        Message: Qu√° nhi·ªÅu y√™u c·∫ßu<br>
                        <br>
                        <strong>Gi·∫£i th√≠ch:</strong> Request b·ªã ch·∫∑n b·ªüi rate limiting.
                    `;
                } else if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>‚ùå Attack might be successful!</strong><br>
                        Status: ${response.status}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ Attack Blocked!</strong><br>
                        Status: ${response.status}<br>
                        <br>
                        <strong>Gi·∫£i th√≠ch:</strong> Server t·ª´ ch·ªëi request.
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ö†Ô∏è Error (expected for CORS/local testing):</strong><br>
                    ${error.message}<br>
                    <br>
                    <strong>Gi·∫£i th√≠ch:</strong> ƒêi·ªÅu n√†y b√¨nh th∆∞·ªùng n·∫øu server ·ªü localhost kh√°c.
                    Khi test th·ª±c t·∫ø, server s·∫Ω reject v√¨ CSRF token thi·∫øu.
                `;
            }
        }

        /**
         * Auto-submit CSRF form
         */
        async function autoSubmitCSRFForm() {
            const resultDiv = document.getElementById('result2');
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ ƒêang auto-submit form trong 3 gi√¢y...';
            
            setTimeout(() => {
                resultDiv.className = 'result';
                resultDiv.innerHTML = '‚è≥ ƒêang g·ª≠i form...';
                
                // Submit form
                document.getElementById('csrfForm').submit();
                
                setTimeout(() => {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ Form ƒë√£ ƒë∆∞·ª£c g·ª≠i!</strong><br>
                        <br>
                        <strong>K·∫øt qu·∫£ mong ƒë·ª£i:</strong><br>
                        - Server s·∫Ω reject v√¨ thi·∫øu CSRF token<br>
                        - Error 403 Forbidden<br>
                        - Message: "CSRF token kh√¥ng h·ª£p l·ªá"<br>
                        <br>
                        <strong>K·∫øt lu·∫≠n:</strong> CSRF Protection ho·∫°t ƒë·ªông! üõ°Ô∏è
                    `;
                }, 500);
            }, 3000);
        }

        /**
         * Reset demo
         */
        function resetDemo() {
            document.getElementById('result1').innerHTML = '';
            document.getElementById('result1').className = 'result';
            document.getElementById('result2').innerHTML = '';
            document.getElementById('result2').className = 'result';
        }

        // Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n khi load trang
        window.addEventListener('load', () => {
            console.log('üîê CSRF Attack Demo Loaded');
            console.log('üìñ H∆∞·ªõng d·∫´n: B·∫•m button "G·ª≠i CSRF Attack" ƒë·ªÉ test');
        });
    </script>
</body>
</html>
