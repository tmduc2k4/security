<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Há»“ sÆ¡ cÃ¡ nhÃ¢n - Security App</title>
  <link rel="stylesheet" href="/css/modern-style.css">
  <style>
    .page-header {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      padding: 2rem 0;
      margin-bottom: 3rem;
    }

    .page-header h1 {
      margin: 0;
      font-size: 2rem;
    }

    .profile-container {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .profile-sidebar {
      background: white;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow-sm);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .profile-avatar {
      width: 200px;
      height: 200px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 5rem;
      margin: 0 auto 1.5rem auto;
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .profile-name {
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .profile-name h2 {
      margin: 0 0 0.5rem 0;
      font-size: 1.5rem;
    }

    .profile-role {
      text-align: center;
      padding: 0.5rem 1rem;
      background: #e0e7ff;
      border-radius: 2rem;
      display: inline-block;
      width: 100%;
      box-sizing: border-box;
      font-size: 0.85rem;
      font-weight: 600;
      color: #3b82f6;
      margin-bottom: 1.5rem;
    }

    .profile-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-gray);
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-blue);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-gray);
      margin-top: 0.25rem;
    }

    .sidebar-links {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .sidebar-links a {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      background: #f9fafb;
      color: var(--text-dark);
      text-decoration: none;
      transition: all var(--transition-fast);
      border-left: 3px solid transparent;
    }

    .sidebar-links a:hover,
    .sidebar-links a.active {
      background: #e0e7ff;
      color: var(--primary-blue);
      border-left-color: var(--primary-blue);
    }

    .sidebar-links span {
      margin-right: 0.75rem;
      font-size: 1.2rem;
    }

    .profile-main {
      background: white;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow-sm);
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--primary-blue);
      color: var(--text-dark);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-gray);
      border-radius: 0.5rem;
      font-size: 0.95rem;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .info-item {
      padding: 1rem;
      background: #f9fafb;
      border-radius: 0.5rem;
      border-left: 4px solid var(--primary-blue);
    }

    .info-label {
      font-size: 0.85rem;
      color: var(--text-gray);
      margin-bottom: 0.25rem;
      font-weight: 600;
    }

    .info-value {
      font-size: 1rem;
      color: var(--text-dark);
      font-weight: 600;
    }

    .alert-info {
      background: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .badge {
      display: inline-block;
      padding: 0.4rem 0.8rem;
      border-radius: 2rem;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .badge-success {
      background: #d1fae5;
      color: #065f46;
    }

    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }

    @media (max-width: 768px) {
      .profile-container {
        grid-template-columns: 1fr;
      }

      .profile-sidebar {
        position: static;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .button-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="container">
        <div class="logo">
          <h1>ğŸ” Security App</h1>
        </div>
        <ul class="nav-links">
          <li><a href="/">Trang chá»§</a></li>
          <li><a href="/laptops">Sáº£n pháº©m</a></li>
          <li><a href="/about">Giá»›i thiá»‡u</a></li>
          <li><a href="/contact">LiÃªn há»‡</a></li>
          <li><a href="/profile" class="active">ğŸ‘¤ Há»“ sÆ¡</a></li>
          <% if (user.role === 'admin' || user.role === 'superadmin') { %>
            <li><a href="/admin">âš™ï¸ Admin</a></li>
          <% } %>
          <li><a href="/logout">ÄÄƒng xuáº¥t</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <main>
    <div class="page-header">
      <div class="container">
        <h1>ğŸ‘¤ Há»“ sÆ¡ cÃ¡ nhÃ¢n</h1>
      </div>
    </div>

    <div class="container">
      <div class="profile-container">
        <!-- Sidebar -->
        <div class="profile-sidebar">
          <div class="profile-avatar">ğŸ˜Š</div>
          <div class="profile-name">
            <h2><%= user.username %></h2>
            <p style="margin: 0; color: var(--text-gray); font-size: 0.85rem;"><%= user.email %></p>
          </div>
          <div class="profile-role">
            ğŸ“Œ <%= user.role.toUpperCase() %>
          </div>

          <div class="profile-stats">
            <div class="stat-item">
              <div class="stat-value">
                <% const createdDate = new Date(user.createdAt); %>
                <%= Math.floor((Date.now() - createdDate) / (1000 * 60 * 60 * 24)) %>
              </div>
              <div class="stat-label">NgÃ y hoáº¡t Ä‘á»™ng</div>
            </div>
            <div class="stat-item">
              <div class="stat-value"><%= user.twoFactorEnabled ? 'âœ…' : 'âŒ' %></div>
              <div class="stat-label">2FA</div>
            </div>
          </div>

          <div class="sidebar-links">
            <a href="#personal" class="active"><span>ğŸ“</span> ThÃ´ng tin cÃ¡ nhÃ¢n</a>
            <a href="#security"><span>ğŸ”’</span> Báº£o máº­t</a>
            <a href="#activity"><span>ğŸ“Š</span> Hoáº¡t Ä‘á»™ng</a>
          </div>
        </div>

        <!-- Main Content -->
        <div class="profile-main">
          <!-- Personal Info Section -->
          <div id="personal">
            <h3 class="section-title">ğŸ“ ThÃ´ng tin cÃ¡ nhÃ¢n</h3>
            
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">TÃªn Ä‘Äƒng nháº­p</div>
                <div class="info-value"><%= user.username %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Email</div>
                <div class="info-value">
                  <%= user.email %>
                  <span class="badge badge-success" style="margin-left: 0.5rem;">âœ“ XÃ¡c thá»±c</span>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Vai trÃ²</div>
                <div class="info-value"><%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %></div>
              </div>
              <div class="info-item">
                <div class="info-label">Tráº¡ng thÃ¡i</div>
                <div class="info-value">
                  <% if (user.isActive) { %>
                    <span class="badge badge-success">ğŸŸ¢ Hoáº¡t Ä‘á»™ng</span>
                  <% } else { %>
                    <span class="badge badge-warning">ğŸŸ¡ Bá»‹ khÃ³a</span>
                  <% } %>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>ğŸ” Äá»•i máº­t kháº©u</label>
              <a href="/change-password" style="display: inline-block; margin-top: 0.5rem;" class="btn btn-primary">
                Äá»•i máº­t kháº©u
              </a>
            </div>
          </div>

          <!-- Security Section -->
          <div id="security" style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-gray);">
            <h3 class="section-title">ğŸ”’ Báº£o máº­t</h3>
            
            <div class="alert-info">
              <strong>ğŸ’¡ ThÃ´ng tin:</strong> Báº£o vá»‡ tÃ i khoáº£n cá»§a báº¡n vá»›i cÃ¡c tÃ­nh nÄƒng báº£o máº­t nÃ¢ng cao
            </div>

            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">XÃ¡c thá»±c 2 yáº¿u tá»‘ (2FA)</div>
                <div class="info-value">
                  <% if (user.twoFactorEnabled) { %>
                    <span class="badge badge-success">âœ… ÄÃ£ báº­t</span>
                  <% } else { %>
                    <span class="badge badge-warning">âŒ ChÆ°a báº­t</span>
                  <% } %>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Máº­t kháº©u láº§n cuá»‘i Ä‘á»•i</div>
                <div class="info-value">
                  <% if (user.passwordLastChanged) { %>
                    <% const lastChanged = new Date(user.passwordLastChanged); %>
                    <%= lastChanged.toLocaleDateString('vi-VN') %>
                  <% } else { %>
                    ChÆ°a Ä‘á»•i
                  <% } %>
                </div>
              </div>
            </div>

            <div style="margin-top: 1.5rem;">
              <a href="/setup-2fa" class="btn btn-primary" style="margin-right: 1rem;">
                <% if (user.twoFactorEnabled) { %>
                  ğŸ”„ Cáº­p nháº­t 2FA
                <% } else { %>
                  ğŸ” Báº­t 2FA
                <% } %>
              </a>
              <a href="/change-password" class="btn btn-secondary">ğŸ”‘ Äá»•i máº­t kháº©u</a>
            </div>
          </div>

          <!-- Activity Section -->
          <div id="activity" style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-gray);">
            <h3 class="section-title">ğŸ“Š Hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y</h3>
            
            <div class="alert-info">
              <strong>ğŸ“ Ghi chÃº:</strong> Má»—i hoáº¡t Ä‘á»™ng Ä‘Äƒng nháº­p Ä‘Æ°á»£c ghi láº¡i Ä‘á»ƒ báº£o vá»‡ tÃ i khoáº£n
            </div>

            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #f9fafb; border-bottom: 2px solid var(--border-gray);">
                  <th style="padding: 1rem; text-align: left; font-weight: 600;">ğŸ“… Thá»i gian</th>
                  <th style="padding: 1rem; text-align: left; font-weight: 600;">âš¡ HÃ nh Ä‘á»™ng</th>
                  <th style="padding: 1rem; text-align: left; font-weight: 600;">ğŸŒ IP</th>
                </tr>
              </thead>
              <tbody>
                <% if (locals.recentActivity && recentActivity.length > 0) { %>
                  <% recentActivity.forEach(activity => { %>
                    <tr style="border-bottom: 1px solid var(--border-gray);">
                      <td style="padding: 1rem;">
                        <% const actDate = new Date(activity.timestamp); %>
                        <%= actDate.toLocaleDateString('vi-VN') %> <%= actDate.toLocaleTimeString('vi-VN') %>
                      </td>
                      <td style="padding: 1rem;">
                        <% if (activity.action === 'login') { %>
                          <span class="badge badge-success">âœ… ÄÄƒng nháº­p</span>
                        <% } else if (activity.action === 'logout') { %>
                          <span class="badge badge-warning">â›” ÄÄƒng xuáº¥t</span>
                        <% } else { %>
                          <%= activity.action %>
                        <% } %>
                      </td>
                      <td style="padding: 1rem; font-family: monospace; font-size: 0.85rem;">
                        <%= activity.ipAddress || 'N/A' %>
                      </td>
                    </tr>
                  <% }); %>
                <% } else { %>
                  <tr>
                    <td colspan="3" style="padding: 1rem; text-align: center; color: var(--text-gray);">
                      ğŸ“­ KhÃ´ng cÃ³ hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y
                    </td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>

          <div class="button-group" style="margin-top: 3rem;">
            <button onclick="location.href='/'" class="btn btn-secondary">â† Quay láº¡i</button>
            <a href="/logout" class="btn btn-danger">ğŸšª ÄÄƒng xuáº¥t</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
        <div>
          <h4>ğŸ” Security App</h4>
          <p>á»¨ng dá»¥ng bÃ¡n laptop vá»›i báº£o máº­t cao</p>
        </div>
        <div>
          <h4>ğŸ“š LiÃªn káº¿t</h4>
          <ul style="list-style: none;">
            <li><a href="/">Trang chá»§</a></li>
            <li><a href="/laptops">Sáº£n pháº©m</a></li>
            <li><a href="/contact">LiÃªn há»‡</a></li>
          </ul>
        </div>
        <div>
          <h4>ğŸ”’ Báº£o máº­t</h4>
          <ul style="list-style: none;">
            <li><a href="/profile">Há»“ sÆ¡</a></li>
            <li><a href="/setup-2fa">2FA</a></li>
            <li><a href="/change-password">Äá»•i máº­t kháº©u</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Security App. Báº£o máº­t lÃ  Æ°u tiÃªn hÃ ng Ä‘áº§u.</p>
      </div>
    </div>
  </footer>
</body>
</html>
